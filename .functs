#!/usr/local/bin/bash

## Functions

# shorthand for standard pandoc output
makepdf ()
{
  pandoc $1.md -o $1.pdf
}

# Start an HTTP server from a directory, optionally specifying the port
function server() {
	local port="${1:-8000}"
	open "http://localhost:${port}/" &
	# statik is good because it won't expose hidden folders/files by default.
	# npm install -g statik
	statik --port "$port" .
}

# whois a domain or a URL
function whois() {
	local domain=$(echo "$1" | awk -F/ '{print $3}') # get domain from URL
	if [ -z $domain ] ; then
		domain=$1
	fi
	echo "Getting whois record for: $domain â€¦"

	# avoid recursion
	# this is the best whois server
	# strip extra fluff
	/usr/bin/whois -h whois.internic.net $domain | sed '/NOTICE:/q'
}

# public ip address and location
function myip() {
  pubip=$(wget -qO- ipinfo.io/ip)
  # curl freegeoip.net/xml/198.203.28.43 ## for full xml ip geolocation
  echo ">>> Public IP Address:"
  echo $pubip
  echo ">>> Location:"
  geoiplookup -f /usr/local/var/GeoIP/GeoLiteCity.dat $pubip
}

function csvpreview(){
	sed 's/,,/, ,/g;s/,,/, ,/g' "$@" | column -s, -t | less -#2 -N -S
}

#### Tools to convert binary to ascii and so forth
## change character to binary
chrbin() {
  echo $(printf \\$(echo "ibase=2; obase=8; $1" | bc))
}
## convert ordinal to binary
ordbin() {
  a=$(printf '%d' "'$1")
  echo "obase=2; $a" | bc
}
## convert ascii to binary
ascii2bin() {
  echo -n $* | while IFS= read -r -n1 char
  do
    ordbin $char | tr -d '\n'
    echo -n " "
  done
}
## convert binary to ascii
bin2ascii() {
  for bin in $*
  do
    chrbin $bin | tr -d '\n'
  done
}


# animated gifs from any video
# from alex sexton   gist.github.com/SlexAxton/4989674
gifify() {
  if [[ -n "$1" ]]; then
	if [[ $2 == '--good' ]]; then
	  ffmpeg -i "$1" -r 10 -vcodec png out-static-%05d.png
	  time convert -verbose +dither -layers Optimize -resize 900x900\> out-static*.png  GIF:- | gifsicle --colors 128 --delay=5 --loop --optimize=3 --multifile - > "$1.gif"
	  rm out-static*.png
	else
	  ffmpeg -i "$1" -s 600x400 -pix_fmt rgb24 -r 10 -f gif - | gifsicle --optimize=3 --delay=3 > "$1.gif"
	fi
  else
	echo "proper usage: gifify <input_movie.mov>. You DO need to include extension."
  fi
}

## Search different sites with Firefox
duck() {
  search=""
  echo "Searching DuckDuckGo: \"$@\""
  for term in $@; do
    search="$search$term+"
  done
  firefox "https://www.duckduckgo.com/?q=$search&ia=web"
}
google() {
  search=""
  echo "Searching Google: \"$@\""
  for term in $@; do
    search="$search$term%20"
  done
  firefox "https://www.google.com/search?q=$search"
}
libgen() {
  search=""
  echo "Searching LibraryGenesis: \"$@\""
  for term in $@; do
     search="$search$term+"
  done
  firefox "http://libgen.io/search.php?req=$search&open=0&res=25&view=simple&phrase=1&column=def"
}
altern() {
  search=""
  echo "Searching AlternativeTo: \"$@\""
  for term in $@; do
     search="$search$term-"
  done
  firefox "https://alternativeto.net/browse/search/?q=$search" # goes to search page
  #firefox "https://alternativeto.net/software/$search"
}
aaarg() {
  search=""
  echo "Searching Aaaaarg for: \"$@\""
  for term in $@; do
     search="$search$term+"
  done
  firefox "http://aaaaarg.fail/search?query=$search"
}
wayback() {
  search=$1
  echo "Searching The Wayback Machine for: $1"
  firefox "https://web.archive.org/web/*/$search"
}

## NEED TO FIX REGEX
# define ()
# {
# lynx -dump 
# "http://www.google.com/search?hl=en&q=define%3A+${1}&btnG=Google+Search" | grep 
# -m 5 -w "*"  | sed 's/;/ -/g' | cut -d- -f5 > /tmp/templookup.txt
#   if [[ -s  /tmp/templookup.txt ]] ;then
#     until ! read response
#       do
#       echo "${response}"
#       done < /tmp/templookup.txt
#     else
#       echo "Sorry $USER, I can't find the term \"${1}\""
#   fi
# rm -f /tmp/templookup.txt
# }
#
#

weather ()
{
  declare -a WEATHERARRAY
  WEATHERARRAY=( 'lynx -dump
  "http://www.google.com/search?hl=en&lr=&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&q=weather+${1}&btnG=Search" 
  | grep -A 5 -m 1 "Weather for"')
  echo ${WEATHERARRAY[@]}
}

## NEED TO FIX REGEX
# translate ()
# {
#   TRANSLATED='lynx -dump "http://dictionary.reference.com/browse/${1}" | grep -i 
# -m 1 -w "${2}:" | sed 's/^[ \t]*//;s/[ \t]*$//''
#   if [[ ${#TRANSLATED} != 0 ]] ;then
#     echo "echo"${1}" in ${TRANSLATED}"
#   else
#     echo "Sorry, I can not translate "${1}" to ${2}"
#   fi
# }

